# Task 2: ComfyUI Workflow – Генератор на изображения за съдържание

Този workflow реализира основната генеративна функционалност от спецификацията (Task 1): текст → изображение с положителен/отрицателен промпт и контролни параметри.

---

## Как се стартира workflow-ът

1. **Стартирайте ComfyUI** локално (напр. `python main.py` в папката на ComfyUI).
2. **Импортирайте workflow-а** в ComfyUI:
   - Отворете ComfyUI в браузър (напр. `http://127.0.0.1:8000`).
   - Load → Open → изберете `workflow_full.json` (или създайте workflow върху шаблона от документацията).
3. **Чрез уеб приложението (Task 3):** подайте параметрите от UI; приложението изпраща API заявка към ComfyUI и получава резултатите.
4. **Ръчно в ComfyUI:** попълнете полетата в нодата (positive/negative prompt, seed, steps, cfg, width, height, batch) и натиснете „Queue Prompt“.

---

## Параметри и как влияят

| Параметър | Къде се задава | Ефект |
|-----------|-----------------|-------|
| **Positive prompt** | CLIP Text Encode (Positive) | Текстово описание на желаното съдържание – какво да се вижда в изображението. |
| **Negative prompt** | CLIP Text Encode (Negative) | Текст за нежелани елементи – размазаност, ниско качество, нежелани обекти. |
| **Seed** | KSampler | Фиксирана стойност → възпроизводим резултат; различен seed → различен изход. Случаен seed при 0 или при „random“. |
| **Steps** | KSampler | Брой стъпки на семплиране. Повече стъпки (20–30) – по-добро качество, по-бавно; по-малко (15–20) – по-бързо. |
| **CFG Scale** | KSampler | Колко строго да се следва промптът. Типично 7–9; твърде високо води до прекалено наситени/изкривени резултати. |
| **Width / Height** | Empty Latent Image | Размер на латентното изображение (напр. 512×512, 768×768). Определя размерите на крайния PNG. |
| **Batch size** | Empty Latent Image (batch) | Брой изображения за една заявка (1–4). Генерират се толкова различни изображения наведнъж. |
| **Sampler / Scheduler** | KSampler | Алгоритъм за семплиране (напр. euler, euler_ancestral, dpmpp_2m) – влияе върху стил и стабилност. |

---

## Модели и ресурси (само наименования)

Вижте **MODELS.md** в същата папка за списък с използваните модели/ресурси (имена, версии, папки). Тези файлове не се качват в репото – инсталират се локално в ComfyUI.

---

## Запис на резултатите и разграничаване по заявка

- **Save Image** нодът записва PNG файлове в изходната папка на ComfyUI (напр. `ComfyUI/output`).
- За разграничаване по заявка се препоръчва:
  - **Именуване:** префикс с timestamp и/или seed, напр. `content_gen_20250130_143022_seed12345_0.png`.
  - **Папки:** подпапка за всяка „сесия“ или заявка (ако workflow-ът или скриптът поддържа създаване на папки).
- В API сценарий уеб приложението може да подава `filename_prefix` (ако нодът го поддържа) с timestamp и seed, за да се получат уникални имена.

---

## Batch – няколко изображения за една заявка

- В **Empty Latent Image** полето `batch_size` се задава на 2, 3 или 4 (или 1 за едно изображение).
- **KSampler** и **VAEDecode** обработват целия batch.
- **Save Image** записва отделен файл за всеки елемент от batch-а (обикновено с суфикс _0, _1, _2, _3 в името).

---

## Файлове в тази папка

- **README.md** (този файл) – как се стартира, параметри, запис, batch.
- **MODELS.md** – списък модели/ресурси (имена, папки).
- **workflow_full.json** – пълен workflow за импорт в ComfyUI (опционално; при липса вижте описание по-долу).
- **workflow_api_prompt.example.json** – пример за API prompt формат за `/prompt` endpoint (за уеб приложението).

При липса на `workflow_full.json` можете да създадете workflow в ComfyUI върху следната верига:  
CheckpointLoaderSimple → CLIPTextEncode (positive) + CLIPTextEncode (negative) → EmptyLatentImage → KSampler → VAEDecode → SaveImage.
